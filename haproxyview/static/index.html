<!doctype html>
<head>
<title>HAProxyView</title>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
		<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

    <style type="text/css">

      body{
        width: 100%;
        height: 100%;
        margin:0;
        padding:0;
        position:relative;
        //background:#151e25 url(bg.jpg);
        //background-position: 0px -300px;
        //background-repeat:no-repeat;
        //background-position: bottom center;
        font:16px/24px 'Droid Sans', 'Tangerine', 'Inconsolata', serif;
     }

      #header {
        width: 100%;
        height: 55px;
        background-image: url(/static/haproxyview.png);
        background-repeat: no-repeat;
        background-position: 20px 5px;
        text-align: right;
        margin-left: -10px;
      }

      #line {
        width: 90%;
        border-bottom: #aaa 2px solid;
        margin-left: auto;
        margin-right: auto;
        margin-top: 5px;
        margin-bottom: 10px;
      }

      #wrap {
        width: 100%;
        display: block;
        text-align: center;
				padding-top: 10px;
      }

			
      #container {
				max-width: 450px;
        color: #2A2A2A;
        display: inline-block;
        background-color: rgba(223, 223, 223, 1);
        border-radius: 8px 8px 8px 8px;
				padding-bottom:5px;
				margin-right:10px;
      }

      #server {
        font-size:1.5em;
		    font-weight: bold;
				padding: 8px;
      }

  #backend {
		width: 100%;
		padding: 2px 0px 2px 0px;
    border-top: #fff 1px solid;
    font-size:0.9em;
		font-weight: bold;
    background-color: rgba(233, 233, 233, 1);
	}

  #listener {
    //display: inline-block;
	 	//margin-right: 2px;
    font-size:0.8em;
	}

  #listener a:hover {
    color: #6e6e6e;
  }

  .tooltip {
    background: rgba(210, 210, 210, 0.9);
    font:12px/16px 'Droid Sans', 'Tangerine', 'Inconsolata', serif;
  }

  .red {
    background-color: rgba(152, 0, 0, 0.46);
  }

  .green {
    background-color: rgba(192, 227, 198, 1);
  }

</style>

<script>
  $(document).ready(function() {
    $( document ).tooltip({
      track: true, 
      tooltipClass: "tooltip",
    });
  });
</script>
<script>
if (!!window.EventSource) {
  var source = new EventSource('/');
  source.onmessage = function(e) {
	  document.getElementById('wrap').innerHTML = '';
		servers = JSON.parse(e.data)

		for (var i in servers) {
			server = servers[i]

			var div = document.createElement('div');
			div.id = 'container'
			div.innerHTML = '<div id="server">' + server.backends[0].proxy_name + '</div>';

		  for (var i in server.backends) {
				backend = server.backends[i] 
			  div.innerHTML += '<div id="backend">' + backend.name + '</div>'

		    for (var i in backend.listeners) {
				  listener = backend.listeners[i] 
					ttip = '';
					for (var prop in listener) {
						ttip +='<p>' + prop + ': ' + listener[prop] + '</p>'
					}
					if (listener['status'] == 'UP') {
			      div.innerHTML += '<div id="listener" class="green" title="' + ttip + '"style="padding: 5px 0px 5px 0px;">' + listener.name + '</div>'
					} else {
			      div.innerHTML += '<div id="listener" class="red" title="' + ttip + '"style="padding: 5px 0px 5px 0px;">' + listener.name + '</div>'
					}
				}
			}

		document.getElementById('wrap').appendChild(div);

		}
			  //document.body.appendChild(div);
//			h1.innerHTML = i;
//			document.getElementById('data').appendChild(h1);
  }
}
</script>
<body>
<div id="line"></div>
<div id="wrap">nothing received yet</div>
</body>
